name: update
description: "Update bot to latest GitHub release"
command: |
  set -e
  REPO="rashpile/pako-telegram"
  BINARY="pako-telegram"
  INSTALL_DIR="$HOME/.config/pako-telegram/bin"

  OS=$(uname -s | tr '[:upper:]' '[:lower:]')
  ARCH=$(uname -m | sed 's/x86_64/amd64/' | sed 's/aarch64/arm64/')

  echo "Fetching latest release..."
  VERSION=$(curl -s https://api.github.com/repos/${REPO}/releases/latest | grep '"tag_name"' | cut -d'"' -f4)

  if [ -z "$VERSION" ]; then
    echo "Error: Could not fetch latest version"
    exit 1
  fi

  echo "Latest version: $VERSION"
  echo "Downloading ${BINARY}-${OS}-${ARCH}..."

  TEMP_FILE=$(mktemp)
  curl -L --progress-bar -o ${TEMP_FILE} "https://github.com/${REPO}/releases/download/${VERSION}/${BINARY}-${OS}-${ARCH}" 2>&1
  chmod +x ${TEMP_FILE}

  echo "Installing to ${INSTALL_DIR}/${BINARY}..."
  mkdir -p ${INSTALL_DIR}
  mv ${TEMP_FILE} ${INSTALL_DIR}/${BINARY}

  echo "Updated to $VERSION"
  echo ""
  echo "Run /restart to apply the update."
timeout: 120s
max_output: 50000
confirm: true
category: system
icon: "ðŸ”„"